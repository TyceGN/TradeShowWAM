<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Whack-a-Mole Game</title>
  <!-- Load Phaser from a CDN -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
  <!-- Recommended Google Fonts links for Pixelify Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
  <!-- Load WebFont Loader -->
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
  <style>
    body { margin: 0; }
  </style>
</head>
<body>
<script>
  // Define the GameScene class
  class GameScene extends Phaser.Scene {
    constructor() {
      super({ key: 'GameScene' });
      this.score = 0;
      this.gameTime = 30; // 30-second timer
    }

    preload() {
      // Load your background and mole assets (update paths as needed)
      this.load.image('background', 'assets/background.png');
      this.load.image('mole', 'assets/mole.png');
    }

    create() {
      // Add the background centered on the canvas (assuming 800x600)
      this.add.image(400, 300, 'background');

      // Create UI elements (score and timer)
      this.createUI();

      // Create a group for moles (spawned later)
      this.moles = this.physics.add.group();

      // Spawn a mole every second
      this.time.addEvent({
        delay: 1000,
        callback: this.spawnMole,
        callbackScope: this,
        loop: true
      });
    }

    // Function to create UI elements
    createUI() {
      console.log('Creating UI elements with Pixelify Sans');
      // Display the current score using the Pixelify Sans font
      this.scoreText = this.add.text(16, 16, 'Score: 0', { 
        font: '32px "Pixelify Sans", sans-serif',
        fill: '#fff'
      });

      // Display timer using the Pixelify Sans font
      this.timerText = this.add.text(300, 80, 'Time: ' + this.gameTime, { 
        font: '45px "Pixelify Sans", sans-serif',
        fill: '#f00'
      });

      // Start timer countdown
      this.time.addEvent({
        delay: 1000,
        callback: () => {
          this.gameTime--;
          this.timerText.setText('Time: ' + this.gameTime);
          if (this.gameTime <= 0) {
            // End the game: stop mole spawns and show "Game Over"
            this.time.removeAllEvents();
            
            // Define box dimensions
            const boxWidth = 400;
            const boxHeight = 150;
            const boxX = (800 - boxWidth) / 2;
            const boxY = (600 - boxHeight) / 2;

            // Create a white rectangle using a graphics object
            const graphics = this.add.graphics();
            graphics.fillStyle(0xffffff, 1);
            graphics.fillRect(boxX, boxY, boxWidth, boxHeight);
            graphics.lineStyle(2, 0xff0000, 1);
            graphics.strokeRect(boxX, boxY, boxWidth, boxHeight);

            // Add "Game Over!" text, centered over the white box using Pixelify Sans
            this.add.text(400, 300, 'Game Over!', { 
              font: '48px "Pixelify Sans", sans-serif',
              fill: '#f00',
              fontStyle: 'bold'
            })
            .setOrigin(0.5, 0.5);
          }
        },
        callbackScope: this,
        loop: true
      });
    }

    spawnMole() {
      // Fixed coordinates for the 9 holes
      const holePositions = [
        { x: 110, y: 506 },
        { x: 385, y: 506 },
        { x: 660, y: 506 },
        { x: 130, y: 362 },
        { x: 405, y: 362 },
        { x: 684, y: 362 },
        { x: 120, y: 252 },
        { x: 395, y: 252 },
        { x: 670, y: 252 }
      ];

      // Choose one random hole position
      const hole = Phaser.Math.RND.pick(holePositions);

      // Create the mole a bit below its hole (e.g., 50 pixels lower)
      let mole = this.moles.create(hole.x, hole.y + 50, 'mole').setInteractive();
      mole.setOrigin(0.5, 1); // bottom center is the anchor

      // Tween the mole to "pop up" from below the hole to its final position
      this.tweens.add({
        targets: mole,
        y: hole.y,           // target y-position (the hole center)
        ease: 'Bounce.easeOut',
        duration: 300,
      });

      // Calculate mole duration based on remaining game time:
      // At start (gameTime = 30) moles stay up for 1500ms, at end (gameTime = 0) they stay up for 800ms.
      let moleDuration = 800 + (this.gameTime / 30) * (1500 - 800);

      // When the mole is clicked/tapped, increase score and remove it
      mole.on('pointerdown', () => {
        mole.destroy();
        this.score += 10;
        this.scoreText.setText('Score: ' + this.score);
      });

      // Automatically remove the mole after the calculated duration if not tapped
      this.time.addEvent({
        delay: moleDuration,
        callback: () => {
          if (mole.active) mole.destroy();
        },
        callbackScope: this
      });
    }
  }

  // Game configuration
  const config = {
    type: Phaser.AUTO,
    width: 800, // design width
    height: 600, // design height
    scale: {
      mode: Phaser.Scale.FIT,          // Scale the game to fit the window while preserving aspect ratio
      autoCenter: Phaser.Scale.CENTER_BOTH  // Center the game in the window
    },
    physics: {
      default: 'arcade',
      arcade: {
        debug: false
      }
    },
    scene: [GameScene]
  };

  // Use WebFont.load to wait for the custom font to be active before starting the game
  WebFont.load({
    google: {
      families: ['Pixelify Sans']
    },
    active: function() {
      console.log('Font loaded, creating game instance');
      // Create the Phaser game instance only after the font is loaded
      const game = new Phaser.Game(config);
    }
  });
</script>
</body>
</html>

